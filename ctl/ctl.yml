categories:
    - category:
        id: -1
        name: "{{CATEGORY}}"
entities:
    - entity:
        id: 926000000
        name: "Прикладные данные блока Сеть Продаж"
        path: "custom/salesntwrk"
        storage: "HDFS"
        parent-id: 900000000
    - entity:
        id: 926010000
        name: "УМиИД"
        path: "custom/salesntwrk/umiid"
        storage: "HDFS"
        parent-id: 926000000
    - entity:
        id: "{{CTL_ENTITY_ID}}"
        name: "УМиИД. Сущность для таблицы dsa_dwh_km_efficiency. Перенос данных из Greenplum в схему custom_salesntwrk_nbo_for_dsa."
        path: "custom/salesntwrk/umiid"
        storage: "HDFS"
        parent-id: 926010000
workflows:
    - monitoring:
        name: "{{WF_NAME}}"
        profile: "{{PROFILE}}"
        singleLoading: true
        killyarnjobonerror: false
        category: "{{CATEGORY}}"
        type: principal
        orchestrator: oozie
        schedule_params:
            eventAwaitStrategy: "and"
            entities:
                - entity:
                      id: # TODO: ctl_entity_id
                      profile: "{{PROFILE}}"
                      statisticId: 2
                      active: true
        init_locks:
            checks:
                - check:
                    entity_id: "{{CTL_ENTITY_ID}}"
                    lock: READ
                    lock_group: INIT
                    profile: "{{PROFILE}}"
                - check:
                    entity_id: "{{CTL_ENTITY_ID}}"
                    lock: WRITE
                    lock_group: INIT
                    profile: "{{PROFILE}}"
                - check:
                      entity_id: # TODO: ctl_entity_id
                      lock: READ
                      lock_group: INIT
                      profile: "{{PROFILE}}"
            sets:
                - set:
                    entity_id: "{{CTL_ENTITY_ID}}"
                    lock: WRITE
                    estimate: 30
                    lock_group: INIT
                    profile: "{{PROFILE}}"
                - set:
                    entity_id: "{{CTL_ENTITY_ID}}"
                    lock: READ
                    estimate: 30
                    lock_group: INIT
                    profile: "{{PROFILE}}"
                - set:
                      entity_id: # TODO: ctl_entity_id
                      lock: WRITE
                      lock_group: INIT
                      profile: "{{PROFILE}}"
        params:
            - param:
                  name: path_to_python
                  prior_value: "{{PATH_TO_PYTHON}}"
            - param:
                  name: y_executor_mem
                  prior_value: "{{Y_EXECUTOR_MEM}}"
            - param:
                  name: y_driver_mem
                  prior_value: "{{Y_DRIVER_MEM}}"
            - param:
                  name: y_executor_cores
                  prior_value: "{{Y_EXECUTOR_CORES}}"
            - param:
                  name: y_min_executors
                  prior_value: "{{Y_MIN_EXECUTORS}}"
            - param:
                  name: y_max_executors
                  prior_value: "{{Y_MAX_EXECUTORS}}"
            - param:
                  name: y_queue
                  prior_value: "{{YARN_QUEUE}}"
            - param:
                  name: user.name
                  prior_value: "{{USER_NAME}}"
            - param:
                  name: app_id
                  prior_value: "{{APP_ID}}"
            - param:
                  name: logstash_url
                  prior_value: "{{LOGSTASH_URL}}"
            - param:
                  name: hadoop_dir_conf
                  prior_value: "{{HADOOP_DIR_CONF}}"
            - param:
                  name: command_spark
                  prior_value: "{{COMMAND_SPARK}}"
            - param:
                  name: spark_conf
                  prior_value: "{{SPARK_CONF}}"
            - param:
                  name: use_spark3
                  prior_value: "{{USE_SPARK3}}"
            - param:
                  name: realm
                  prior_value: "{{REALM}}"    # global parameter
            - param:
                  name: kerb_keytab
                  prior_value: "{{KERB_KEYTAB}}"
            - param:
                  name: kerb_principal
                  prior_value: "{{KERB_PRINCIPAL}}"
            - param:
                  name: oozie.wf.application.path
                  prior_value: "{{OOZIE_APP_PATH}}"
            - param:
                  name: path_to_proj_hdfs
                  prior_value: "{{PATH_TO_PROJ_HDFS}}"
            - param:
                  name: path_to_logs_in_hdfs
                  prior_value: "{{PATH_TO_LOGS_IN_HDFS}}"
            - param:
                  name: ctl_entity_id
                  prior_value: "{{CTL_ENTITY_ID}}"
            - param:
                  name: wf_name
                  prior_value: "{{WF_NAME}}"
            - param:
                  name: etl_trgt_tbls
                  prior_value: "{{ETL_TRGT_TBLS}}"
            - param:
                  name: etl_tbls_loc
                  prior_value: "{{ETL_TBLS_LOC}}"
            - param:
                  name: trgt_lifetime_in_days
                  prior_value: "{{TRGT_LIFETIME_IN_DAYS}}"
            - param:
                  name: etl_src_tbls
                  prior_value: "{{ETL_SRC_TBLS}}"
            - param:
                  name: business_date_columns
                  prior_value: "{{BUSINESS_DATE_COLUMNS}}"
            - param:
                  name: parquet_size_in_blocks
                  prior_value: "{{PARQUET_SIZE_IN_BLOCKS}}"
            - param:
                  name: etl_force_load
                  prior_value: "0"